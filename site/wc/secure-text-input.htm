<link rel="import" href="/lib/polymer.html">
<script src="/lib/openpgp.min.js"></script>

<dom-module id="f-secure-text-input" attributes="armoredOutput">

	<template>
		<link rel="stylesheet" href="/css/blocks/f-text-input.css">
		<link rel="stylesheet" href="/css/blocks/f-button-basic.css">

		<form id="contactForm" action="http://localhost:10420/openpgp.htm" method="GET">
			<input type="hidden" value="" id="secretFormSource">
			<div class="f-text-input f-text-input_multiline">
				<label class="f-text-input__label">Message
					<textarea id="enctext" class="f-text-input__text-field" rows="6" placeholder="This is OpenPGP encrypted using the OpenPGP.js library"></textarea>
				</label>
			</div>
				<input type="submit" class="f-button-basic" >
				<input type="reset" class="f-button-basic">
		</form>

	</template>

	<script>
		Polymer({
			/* this is the element's prototype */
			is: 'f-secure-text-input',
			ready: function() {
				// debugger;
				window.openpgp.initWorker({ path:"/lib/openpgp.worker.js" }) // set the relative web worker path
				// window.openpgp.config.aead_protect = true // activate fast AES-GCM mode (not yet OpenPGP standard)
				var public = openpgp.key.readArmored(this.secretSource).keys
console.log(public)
				var self = this
				this.$$("input[type='submit']").addEventListener("click", function(e) {
					e.preventDefault()
					console.log( self.$.enctext.value )
					openpgp.encrypt({
						publicKeys: public,
						data: self.$.enctext.value
					}).then(function(ciphertext) {
							encrypted = ciphertext.data; // '-----BEGIN PGP MESSAGE ... END PGP MESSAGE-----'
							console.log(encrypted)
							self.$.secretFormSource.value = encrypted
							var contactForm = self.$.contactForm 
							setTimeout(z, 5000)
					});

				})
			}, secretSource: `-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.4.13 (MingW32)

mI0EVzpzJAEEAOczHUF98HyisH1XDN2i3amY2Q7V3hjfhKi4VC5FevgkFH//tPUh
1zDld92b1zmC2aBj4tJ7B57g7ohBQO/5KOTf6GVQLuuqAXLNyUdbMa1xtOIP8byb
HgyFDyhol5GRBeCxvbL8EHJEY/WEa2XIS6NcDjDJYrg8ERFnF7PladTxABEBAAG0
CVRlc3QgTWFuZIi+BBMBAgAoBQJXOnMkAhsDBQkAJ40ABgsJCAcDAgYVCAIJCgsE
FgIDAQIeAQIXgAAKCRCfcYCk0/uwS2kcBACCebL1e02SG/No1gH6/1A1ifQhj9d7
J5d8o69lQEI6niegT27jKRI+D5Bo8tQfX3i4eftTAJBUlWxcEk1eCE7mf18aiowM
GZ8aizTtf3CIIKq8lhPdHLsAUcPgZOARBAJEpjC/kvwFAJesmPx08l+CmfLOcOxz
KSnWsAxpPwrUnbiNBFc6cyQBBADJoYbvUqmyWQlPc/vo6ugppQiuHGURSIyAXXH9
sQ+36n8yzTED/8s2jmj2WEbFP47K1NVIBgov6V/C8eCMjScoIxqmOnlh7prJ2rg7
5EwwPj2As5ciIwow+t30skJRvwAxh0qa8+oicwsY4KTjAEiFzbqLIv8/GTjGmbH6
5+LNAwARAQABiKUEGAECAA8FAlc6cyQCGwwFCQAnjQAACgkQn3GApNP7sEvPnAP/
YRPMk0RdBSXCKBkt94Pukr6lPulBt+SzhTGarjYP0cnIcaqGeJOgH8dLlbpBvmx6
snBsJAo3cIjqDmw/E7+VOpdk0jFrcI4fKUXcT2E7ywAzszQ7ayc8QLimUQJyba+/
LjSacZsYqWRmM+9k6w3XZren33fIXweEguZ7raQapV8=
=q3KY
-----END PGP PUBLIC KEY BLOCK-----
`
		})
  </script>

</dom-module>